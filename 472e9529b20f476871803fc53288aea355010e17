{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "9f687e36_e9ea4171",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1017725
      },
      "writtenOn": "2022-12-10T20:38:29Z",
      "side": 1,
      "message": "recheck infrared-pipeline",
      "revId": "472e9529b20f476871803fc53288aea355010e17",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "32df7402_32883ffd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1017725
      },
      "writtenOn": "2022-12-10T23:57:35Z",
      "side": 1,
      "message": "recheck",
      "revId": "472e9529b20f476871803fc53288aea355010e17",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e5a47aab_9e24cc02",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1017725
      },
      "writtenOn": "2022-12-12T13:21:34Z",
      "side": 1,
      "message": "Controller replacement job passes when using these diffs:  https://rhos-ci-staging-jenkins.lab.eng.tlv2.redhat.com/view/DFG/view/df/view/controller_replacement/job/DFG-df-controller_replacement-17.0-virthost-3cont_3comp_3ceph-yes_UC_SSL-yes_OC_SSL-ceph-ipv4-geneve-replace_controller-RHELOSP-31864/47/",
      "revId": "472e9529b20f476871803fc53288aea355010e17",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9412d457_874c1890",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1006992
      },
      "writtenOn": "2022-12-12T16:36:32Z",
      "side": 1,
      "message": "Thank you David. This all looks good to me. I have a minor suggestion for readability and to possibly make it easier to debug in the future.",
      "revId": "472e9529b20f476871803fc53288aea355010e17",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "eb62955b_f15d84db",
        "filename": "post_tasks/roles/add-node/tasks/normal_flow.yml",
        "patchSetId": 1
      },
      "lineNbr": 155,
      "author": {
        "id": 1016110
      },
      "writtenOn": "2022-12-12T15:10:26Z",
      "side": 1,
      "message": "Please note that infrared is now branched, so the code can support natively the new behavior. master currently targets OSP17.1 and OSP17 is for 17.0.",
      "revId": "472e9529b20f476871803fc53288aea355010e17",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "22d1686b_79722b46",
        "filename": "post_tasks/roles/add-node/tasks/normal_flow.yml",
        "patchSetId": 1
      },
      "lineNbr": 155,
      "author": {
        "id": 1017725
      },
      "writtenOn": "2022-12-12T19:46:47Z",
      "side": 1,
      "message": "cloud-config plugin does not appear to be branched. At least view all branches does not show individual OSP branches like tripleo-overcloud plugin does. In that case I need to have this line like it is??",
      "parentUuid": "eb62955b_f15d84db",
      "revId": "472e9529b20f476871803fc53288aea355010e17",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c8afd8f5_34cb7a43",
        "filename": "post_tasks/roles/add-node/tasks/normal_flow.yml",
        "patchSetId": 1
      },
      "lineNbr": 155,
      "author": {
        "id": 1016110
      },
      "writtenOn": "2022-12-12T20:14:32Z",
      "side": 1,
      "message": "You are right, it is part of the plans but it\u0027s not the case yet.",
      "parentUuid": "22d1686b_79722b46",
      "revId": "472e9529b20f476871803fc53288aea355010e17",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c979e06c_29ab0e9b",
        "filename": "post_tasks/roles/add-node/tasks/normal_flow.yml",
        "patchSetId": 1
      },
      "lineNbr": 255,
      "author": {
        "id": 1016110
      },
      "writtenOn": "2022-12-12T15:10:26Z",
      "side": 1,
      "message": "Please note there is more than just composable_roles or virt as options.\n\nThere is --deployment-files, see how it is used in plugins/tripleo-overcloud/build_templates.yml for example\n\n  vars:\n      source_dir: \"{{ install.deployment.files }}\"\n      [...]\n      template_base: \"{{ ansible_user_dir }}/{{ source_dir | basename }}\"",
      "revId": "472e9529b20f476871803fc53288aea355010e17",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b060370c_eb3ed384",
        "filename": "post_tasks/roles/add-node/tasks/normal_flow.yml",
        "patchSetId": 1
      },
      "lineNbr": 255,
      "author": {
        "id": 1017725
      },
      "writtenOn": "2022-12-12T19:46:47Z",
      "side": 1,
      "message": "The overcloud deploy stage includes options like these --deployment-files composable_roles or --deployment-files virt. However, existing cloud config stages do not include the --deployment-files option. The result is that {{ install.deployment.files }} isn\u0027t known to cloud-config. It seems that making cloud-config plugin aware of the template location may be outside scope of this review. What do you think? Is handling the most common options of virt and composable_roles enough?",
      "parentUuid": "c979e06c_29ab0e9b",
      "revId": "472e9529b20f476871803fc53288aea355010e17",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6a1acb39_f22b926b",
        "filename": "post_tasks/roles/add-node/tasks/normal_flow.yml",
        "patchSetId": 1
      },
      "lineNbr": 255,
      "author": {
        "id": 1016110
      },
      "writtenOn": "2022-12-12T20:14:32Z",
      "side": 1,
      "message": "They don\u0027t include it but I think the option is injected somehow from the previous infrared calls using the environment variables. In fact at least post_tasks/create_external_network.yml uses it. Have you tried using it?",
      "parentUuid": "b060370c_eb3ed384",
      "revId": "472e9529b20f476871803fc53288aea355010e17",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2f54a9de_eb8cc8ef",
        "filename": "post_tasks/roles/add-node/tasks/normal_flow.yml",
        "patchSetId": 1
      },
      "lineNbr": 331,
      "author": {
        "id": 1006992
      },
      "writtenOn": "2022-12-12T16:36:32Z",
      "side": 1,
      "message": "Good. This will add the host, which is managable (over SSH) via the control-plane IP, to the ceph cluster. It will still bring up the storage service on the storage network by virtue of the ceph configuration of the cluster it joins.",
      "range": {
        "startLine": 331,
        "startChar": 83,
        "endLine": 331,
        "endChar": 100
      },
      "revId": "472e9529b20f476871803fc53288aea355010e17",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "24197b63_5458a3d2",
        "filename": "post_tasks/roles/add-node/tasks/normal_flow.yml",
        "patchSetId": 1
      },
      "lineNbr": 338,
      "author": {
        "id": 1015563
      },
      "writtenOn": "2022-12-12T14:14:38Z",
      "side": 1,
      "message": "Should there not a an `openstack overcloud deploy` step here?",
      "revId": "472e9529b20f476871803fc53288aea355010e17",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "65071364_5108e4d6",
        "filename": "post_tasks/roles/add-node/tasks/normal_flow.yml",
        "patchSetId": 1
      },
      "lineNbr": 338,
      "author": {
        "id": 1017725
      },
      "writtenOn": "2022-12-12T14:41:03Z",
      "side": 1,
      "message": "The plugin\u0027s existing overcloud deploy command is used which happens a few steps later than the comment. After normal_flow.yml completes the job executes replace_node.yml where the overcloud deploy is executed here: https://review.gerrithub.io/c/rhos-infra/cloud-config/+/547322/1/post_tasks/roles/replace-controller/tasks/replace_node.yml#80",
      "parentUuid": "24197b63_5458a3d2",
      "revId": "472e9529b20f476871803fc53288aea355010e17",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "70ab2e17_4d339c0b",
        "filename": "post_tasks/roles/add-node/tasks/normal_flow.yml",
        "patchSetId": 1
      },
      "lineNbr": 338,
      "author": {
        "id": 1015563
      },
      "writtenOn": "2022-12-12T14:50:03Z",
      "side": 1,
      "message": "Ack, thanks for explaining.",
      "parentUuid": "65071364_5108e4d6",
      "revId": "472e9529b20f476871803fc53288aea355010e17",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9d7b2897_429b5eb8",
        "filename": "post_tasks/roles/replace-controller/tasks/remove_ceph_monitor.yml",
        "patchSetId": 1
      },
      "lineNbr": 67,
      "author": {
        "id": 1006992
      },
      "writtenOn": "2022-12-12T16:22:00Z",
      "side": 1,
      "message": "this procedure looks good to me",
      "range": {
        "startLine": 67,
        "startChar": 8,
        "endLine": 67,
        "endChar": 51
      },
      "revId": "472e9529b20f476871803fc53288aea355010e17",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "853c5c04_eda869e8",
        "filename": "post_tasks/roles/replace-controller/tasks/remove_ceph_monitor.yml",
        "patchSetId": 1
      },
      "lineNbr": 91,
      "author": {
        "id": 1006992
      },
      "writtenOn": "2022-12-12T16:22:00Z",
      "side": 1,
      "message": "Right, this task and the next happen not on the node being removed but on another node, e.g. controller-1 in the scratch doc we had.",
      "revId": "472e9529b20f476871803fc53288aea355010e17",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "95954291_bc5fad3b",
        "filename": "post_tasks/roles/replace-controller/tasks/remove_ceph_monitor.yml",
        "patchSetId": 1
      },
      "lineNbr": 160,
      "author": {
        "id": 1006992
      },
      "writtenOn": "2022-12-12T15:31:08Z",
      "side": 1,
      "message": "I think this line with `ceph orch host drain` is the only one necessary for this task. I don\u0027t expect the keyring or conf to change as a result of the drain so I don\u0027t think we need the extra cp\u0027s and rm\u0027s.\n\nThe ceph.conf for the ceph server becomes centralized in a DB under cephadm management and the \u0027ceph config\u0027 is authoritative (not ceph.conf). \n\n  https://docs.ceph.com/en/latest/man/8/ceph/#config\n\nceph.conf itself is used my ceph clients (nova) but if the IP if the mon to be replaced stays the same, then they don\u0027t need a new copy. The client ceph.conf is in a diff path defined by:\n\nhttps://github.com/openstack/tripleo-heat-templates/blob/stable/wallaby/deployment/cephadm/ceph-client.yaml#L61",
      "revId": "472e9529b20f476871803fc53288aea355010e17",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ed0fb039_f881b763",
        "filename": "post_tasks/roles/replace-controller/tasks/remove_ceph_monitor.yml",
        "patchSetId": 1
      },
      "lineNbr": 160,
      "author": {
        "id": 1017725
      },
      "writtenOn": "2022-12-12T15:47:28Z",
      "side": 1,
      "message": "I had a lot of trouble with this step. When doing the procedure manually I went into cephadm shell and then executed the host drain command. Worked with no problem. When doing the automation it was all one step i.e. automation executes the command: cephadm shell ceph orch host drain. After that command is executed all ceph commands failed with error: ObjectNotFound(\u0027RADOS object not found. After looking at it for a long time I saw the /etc/ceph/ceph.conf and /etc/ceph/ceph.client.admin.keyring were being deleted. After that I saved them, let them be deleted, and then replaced them. The automation worked after that. If you know of a way to do the ceph drain without it deleting those files then I would do it. I could not find a way.",
      "parentUuid": "95954291_bc5fad3b",
      "revId": "472e9529b20f476871803fc53288aea355010e17",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "78a8805e_9a701656",
        "filename": "post_tasks/roles/replace-controller/tasks/remove_ceph_monitor.yml",
        "patchSetId": 1
      },
      "lineNbr": 160,
      "author": {
        "id": 1006992
      },
      "writtenOn": "2022-12-12T16:08:33Z",
      "side": 1,
      "message": "Interesting. OK, let\u0027s keep it as is for now. I\u0027ll look more into it and let you know and maybe it can be changed in a follow up patch if necessary.",
      "parentUuid": "ed0fb039_f881b763",
      "revId": "472e9529b20f476871803fc53288aea355010e17",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "00356590_18bfd3b4",
        "filename": "post_tasks/roles/replace-controller/tasks/replace_node.yml",
        "patchSetId": 1
      },
      "lineNbr": 109,
      "author": {
        "id": 1006992
      },
      "writtenOn": "2022-12-12T16:36:32Z",
      "side": 1,
      "message": "We expect the ceph.yaml to be present because it was created with the following task:\n\nhttps://review.gerrithub.io/c/rhos-infra/cloud-config/+/547322/1/post_tasks/roles/replace-controller/tasks/remove_ceph_monitor.yml#89\n\nIt might help readability of the playbook to state how this file was created. E.g.\n\n  # see remove_ceph_monitor.yml task \"export ceph spec on working controller\"\n  # for information on how spec.yml was created\n  \nOr you could have a task prior to this one which fails early if that file is missing and have the error message say where the file should have come from.",
      "revId": "472e9529b20f476871803fc53288aea355010e17",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4964bc0e_255aa673",
        "filename": "post_tasks/roles/replace-controller/tasks/replace_node.yml",
        "patchSetId": 1
      },
      "lineNbr": 109,
      "author": {
        "id": 1017725
      },
      "writtenOn": "2022-12-12T19:46:47Z",
      "side": 1,
      "message": "I will update diffs to include the comment or a new task that prints a message when spec.yml is not found.",
      "parentUuid": "00356590_18bfd3b4",
      "revId": "472e9529b20f476871803fc53288aea355010e17",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    }
  ]
}